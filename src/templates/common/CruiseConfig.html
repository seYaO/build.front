<!--邮轮公共站点统一配置-->
<% 
    ctx.EnvVariabl = (function(){
        /**
         * 0 线上
         * 1 线下，预发
         * 2 QA
         * 3 本地开发
         */
        var hostName = ctx.hostname.replace(/:\d+$/,""),
            desc = "本地开发环境 例如 localhost 127.0.0.1 10.101.XXX.XXX",
            code = 3,
            regx_0 = /^[a-z]+\.ly\.com$/i,
            regx_1 = /\.t\.ly\.com$/i,
            regx_2 = /\.qa\.ly\.com$/i,
            regx_3 = /^(localhost|127\.0\.0\.1|10\.101\.[0-9]{1,3}\.[0-9]{1,3})$/i;
        if(regx_3.test(hostName)){//线下本地环境
            code = 3;
            desc = "本地开发环境 例如 localhost 127.0.0.1 10.101.XXX.XXX";
        }else if(regx_1.test(hostName)){
            code = 1;
            desc = "线下预发/测试环境 例如 www.t.ly.com";
        }else if(regx_2.test(hostName)){
            code = 2;
            desc = "QA测试环境 例如 www.qa.ly.con";
        }else if(regx_0.test(hostName)){
            code = 0;
            desc = "线上正式环境 www.ly.com";
        }else{
            code = 1;
            desc = "未知环境 默认选择线下环境部署";
        }
        return {
            code : code,
            hostName : hostName,
            desc : desc
        };
    })();
	ctx.channel="youlun";
	ctx.vrcode="10002-2007-0";
	ctx.pcUrl=ctx.EnvVariabl.code == 3 ? "http://www.ly.com" : ctx.protocol+"://"+ctx.hostname;//"http://www.ly.com";
    ctx.webApiUrl = ctx.EnvVariabl.code == 0  ?  "http://tcinnerapi.17usoft.com/cruise/front/api":ctx.EnvVariabl.code == 2?"http://tcinnerapi.qa.17usoft.com/cruise/front/api":"http://tcinnerapi.t.17usoft.com/cruise/front/api";
	ctx.clientIp=ctx.reqIPAddr;
    ctx.CityId=ctx.query["CityID"]||ctx.getCookie('ylCityid')||ctx.getCookie('NCid')||0;
    ctx.ConfMarketingCenterVersion="1.20";
	ctx.ConfLineResourceVersion="1.12";
    ctx.ConfFrontCommentVersion="1.2";
%>
    <%?
    ctx.request(ctx.webApiUrl+"/TcConfigure/GetDsfConfigStrings",function(err,httpResponse,body){
        if(err) return aries();
        if(httpResponse.statusCode!=200) return aries();
        try{
            ctx.dsfConfigInfo=JSON.parse(body);
        }catch(e){
            ctx.dsfConfigInfo=JSON.parse('{}');
        }
        aries();
    });
%>

        <%
    ctx.dsfConfigInfo=ctx.dsfConfigInfo && ctx.dsfConfigInfo.Data||[];
    for(let i=0,len=ctx.dsfConfigInfo.length;i<len;i++){
        var _dsfConfigInfoItem=ctx.dsfConfigInfo[i],
            _serviceGroupName=(_dsfConfigInfoItem["ServiceGroupName"]||"").toLowerCase();
        //_serviceGroupName=_serviceGroupName.split(".").join("");
        //ctx[_serviceGroupName]=_dsfConfigInfoItem["Version"];
        if(_serviceGroupName=="dsf.tccruise.resource.marketingcenter")ctx.ConfMarketingCenterVersion=_dsfConfigInfoItem["Version"];
        if(_serviceGroupName=="dsf.tccruise.resource.lineresource") ctx.ConfLineResourceVersion=_dsfConfigInfoItem["Version"];
        if(_serviceGroupName=="dsf.cruise.front.comment.service")  ctx.ConfFrontCommentVersion=_dsfConfigInfoItem["Version"];
    }
%>