{{?it.lineList && it.lineList.length && it.lineList[0].line && it.lineList[0].line.length}}
{{var destName = it.BaseData.DestName;}}
{{
    var festivals = {
        "20170404":'清明节',
        "20170501":'劳动节',
        "20170514":'母亲节',
        "20170530":'端午节',
        "20170601":'儿童节',
        "20170618":'父亲节',
        "20170828":'七夕',
        "20170910":'教师节',
        "20171001":'国庆节',
        "20171004":'中秋节',
        "20171102":'感恩节',
        "20171224":'平安节',
        "20171225":'圣诞节',
        "20180101":'元旦',
        "20180214":'情人节',
        "20180215":'除夕',
        "20180216":'春节',
        "20180302":'元宵',
        "20180405":'清明节'
    };
}}
{{
    function processHighlight(html, highLightKey){  
        if (highLightKey) {
            if(highLightKey === "\\"){  
                highLightKey = "\\\\";
            }
            var hightlightReg = new RegExp(highLightKey, "g");
            return  html.replace(/(>|^)([^>^<]+)(<|$)/g,function($reg){
                return $reg.replace(hightlightReg, function($mac){
                    return '<span class="autofill_hili">' + $mac + '</span>';
                })
            });
        } else {
            return html;
        }
    }
}}
<ul class="line-list">
    {{~it.lineList[0].line:pro}}
        {{var linkUrl = "",
            property = "",
            proClass = "";}}
        {{?pro.prop == 3}}
            {{?pro.isTpackage == '0'}}
                {{linkUrl = "/dujia/tours/" + pro.id + "/";}}
                {{property = "自由行";}}
                {{proClass = "free";}}
            {{??}}
                {{linkUrl = "/dujia/tours/p" + pro.id + "/";}}
                {{property = "机酒任选";}}
                {{proClass = "package";}}
            {{?}}
        {{??}}
            {{linkUrl = "/dujia/tours/" + pro.id + ".html";}}
            {{?pro.prop == 1}}
                {{property = "跟团游";}}
                {{proClass = "pack";}}
            {{??}}
                {{property = "目的地参团";}}
                {{proClass = "local";}}
            {{?}}
        {{?}}
        <li data-id="{{=pro.id}}" data-url="{{=linkUrl}}">
            <div class="line-info">
                <div>
                    {{var seasonTitle = pro.clractTitleName ? ("【" + pro.clractTitleName + "】") : "";}}
                    {{var proTitle = "<b>" + seasonTitle + pro.title + "</b>" + pro.subTitle;}}
                    {{proTitle = processHighlight(proTitle, destName);}}
                    <p class="line-title" title="{{=seasonTitle + pro.title + pro.subTitle}}">{{=proTitle}}</p>
                    <div class="line-label clearfix">
                        {{?pro.isTCSpecialLine != 0 && it.isTCSpecialLineList && it.isTCSpecialLineList.length && it.isTCSpecialLineList[0].isTCSpecialLine && it.isTCSpecialLineList[0].isTCSpecialLine.length}}
                            <span data-content="{{=it.isTCSpecialLineList[0].isTCSpecialLine[0].notes}}" class="icon-tczx J_Tips"></span>
                        {{?}}
                        {{?pro.isExtraordinary != 0 && it.isExtraordinaryList && it.isExtraordinaryList.length && it.isExtraordinaryList[0].isExtraordinary && it.isExtraordinaryList[0].isExtraordinary.length}}
                            <span data-content="{{=it.isExtraordinaryList[0].isExtraordinary[0].notes}}" class="icon-ffxl J_Tips"></span>
                        {{?}}
                        {{?pro.isBlh != 0 && pro.blhContent}}
                            {{var blhTips = "",
                                  blhContent = pro.blhContent.split(/\d+\./g);}}
                            {{var blhCount = 0;}}
                            {{~blhContent:blh}}
                                {{?blh}}
                                    {{blhCount++;}}
                                    {{blhTips += blhCount + "." + blh + "<br />";}}
                                {{?}}
                            {{~}}
                            <span data-content='<div><strong>积分抵扣</strong><hr />{{=blhTips}}</div>' class="J_Tips" style='border:solid 1px #ff6d4f; color:#ff6d4f;'>积分抵扣</span>
                        {{?}}
                        {{?pro.isSuper != 0 && pro.superContent}}
                            {{var superTips = "",
                                    superContent = pro.superContent.split(/\d+\./g);}}
                            {{var superCount = 0;}}
                            {{~superContent:sup}}
                                {{?sup}}
                                    {{superCount++;}}
                                    {{superTips += superCount + "." + sup + "<br />";}}
                                {{?}}
                            {{~}}
                            <span data-content='<div><strong>vip超值购</strong><hr />{{=superTips}}</div>' class="J_Tips" style='border:solid 1px #ff6d4f; color:#ff6d4f;'>vip超值购</span>
                        {{?}}

                        {{?pro.isStrict != 0 && pro.strictContent}}
                            {{var strTips = "",
                                  strContent = pro.strictContent.split(/\d+\./g);}}
                            {{var strCount = 0;}}
                            {{~strContent:str}}
                                {{?str}}
                                    {{strCount++;}}
                                    {{strTips += strCount + "." + str + "<br />";}}
                                {{?}}
                            {{~}}
                            <span data-content='<div><strong>同程严选</strong><hr />{{=strTips}}</div>' class="J_Tips" style='border:solid 1px #ff6d4f; color:#ff6d4f;'>同程严选</span>
                        {{?}}
                        {{?pro.disList && pro.disList.length && pro.disList[0].discount && pro.disList[0].discount.length}}
                        {{~pro.disList[0].discount:preferList}}
                            {{var flag = false;}}
                            {{?preferList.realIconId != "58" && preferList.realIconId != "63" && preferList.realIconId != "62"}}
                                {{var name = "";}}
                                {{var iconContent = "";}}

                                {{?preferList.name.Length > 4}}
                                    {{name = preferList.name.Substring(0, 4);}}
                                {{??}}
                                    {{name = preferList.name;}}
                                {{?}}

                                {{if(name == "第二人半"){name = "第二人半价";}}}
                                {{?preferList.longContent}}
                                    {{var tips = preferList.longContent.split(/\d+\./g);}}
                                    {{var tipCount = 0;}}
                                    {{~tips:iconTip}}
                                        {{?iconTip}}
                                            {{tipCount++;}}
                                            {{iconContent += tipCount + "." + iconTip + "<br />";}}
                                        {{?}}
                                    {{~}}
                                {{?}}

                                {{var content = "<div><strong>" + preferList.name + "</strong><hr />" + iconContent + "</div>";}}
                                {{var iconStyle = "border:solid 1px " + preferList.iconColor + "; color:" + preferList.iconColor + ";";}}
                                {{?name}}
                                    <span data-content='{{=content}}' class="J_Tips" style='{{=iconStyle}}'>{{=name}}</span>
                                {{?}}
                            {{?}}
                        {{~}}
                        {{?}}
                        {{?pro.whiteBarFlag != 0}}
                            <span data-content="{{=pro.whiteBarValue}}" class="J_Tips">分期付款</span>
                        {{?}}
                        {{?pro.isExtraordinary == 0}}
                            <span data-content='<div>
                                    1.点评成功后，您将获得25-50元不等的点评奖金,审核通过后返还至您的奖金账户。<br /><span style="color: #ff7800">
                                    2.如果您的点评足够细致、有特色，将有机会被评为精华点评，被评为精华点评，奖金是原点评奖金的2倍哦！</span><br /><span style="color: #ff7800">
                                    3.若是点评上传图片，图片实拍，成像清晰美丽，被评为精华点评机会更大哦！</span></div>' 
                                class="J_Tips">点评返现</span>
                        {{??}}
                            <span data-content='<div>
                                    1.点评提交，通过审核后您将可以获得<span style="color: #ff7800">100元/人</span>的立返奖金，返现人数即参与点评人数（奖金统一返至预定人立返奖金账户）。<br />
                                    2.出游前一天会有短信通知，出游后即可点击短信中的链接参与非凡点评。<br />
                                    3.非凡点评需满足100字以上的文字+4张以上的图片，每个出游人的点评内容不可完全一致哦。<br />
                                    4.在回团后15天内点评有效。</div>' 
                            class="J_Tips">非凡立返</span>
                        {{?}}
                    </div>
                    <p class="line-tip">
                        {{?pro.portCity && (pro.prop != 10)}}
                            <span class="line-dep"><i></i>{{=pro.portCity}}出发</span>
                        {{?}}
                        {{?pro.serviceCharName}}{{var serviceName = pro.serviceCharName.split(";").pop();}}
                            {{~serviceName:service}}
                                <span class="pro-light">{{=service}}</span>
                            {{~}}
                        {{?}}
                        {{?pro.rcImgTitle}}
                            {{var rcTitle = pro.rcImgTitle.split(",");}}
                            {{~rcTitle:rcImg}}
                                <span class="pro-light">{{=rcImg}}</span>
                            {{~}}
                        {{?}}
                    </p>
                    <p class="line-dates">
                        {{?pro.isTpackage == 0}}
                            {{var lineDate = "", cellDate = "", gdDate = pro.gdDate.split(";"); gdDate.pop(); var gdLength = gdDate.length;}}
                            {{var dateSolarArr = [], dateNumArr = [], dateArr = [];}}
                            {{~gdDate:startDate:gdIndex}}
                                {{
                                    var count = 0;
                                    for (var key in festivals) {
                                        if (key == startDate) {
                                            count++;
                                            dateSolarArr.push(festivals[key]);
                                            break;
                                        }
                                    }
                                    if (!count) {
                                        lineDate = gdDate[gdIndex].substring(4,6) + "-" + gdDate[gdIndex].substring(6);
                                        dateNumArr.push(lineDate);
                                    }
                                }}
                            {{~}}
                            {{dateArr = dateSolarArr.concat(dateNumArr);}}
                            {{var len = dateArr.length;}}
                            {{
                                for (var i = 0; i < len; i++) {
                                    if (len > 7) {
                                        if (i < 6) {
                                            cellDate += dateArr[i] + " | ";
                                        } else {
                                            cellDate += "... | ";
                                            break;
                                        }
                                    } else if (len > 1 && len < 7) {
                                        if (i < len - 1) {
                                            cellDate += dateArr[i] + " | ";
                                        } else {
                                            break;
                                        }
                                    } else {
                                        break;
                                    }
                                }
                            }}
                            {{cellDate  +=  gdDate[gdLength-1].substring(0,4) + "-" + gdDate[gdLength-1].substring(4,6) + "-" + gdDate[gdLength-1].substring(6);}}
                            <span class="date-txt">团期 : </span><span class="date-list">{{=cellDate}}</span><a href="{{=linkUrl}}" target="_blank" class="date-more" data-id="{{=pro.id}}">更多<i></i></a>
                        {{??}}
                            <span class="date-txt">团期 : </span>
                            <span class="date-list">天天发团</span>
                        {{?}}
                    </p>
                    <div class="line-imgbox">
                        <div class="img-panel">
                            <img src="{{=pro.absImgURL.replace('http:','')}}">
                        </div>
                        <span class="mark {{=proClass}}">{{=property}}</span>
                        {{?pro.recommendReason}}<span class="mark-recommand {{=proClass}}" title="{{=pro.recommendReason}}">{{=(pro.recommendReason.length < 7) ? pro.recommendReason : pro.recommendReason.substring(0,6)}}</span>{{?}}
                        <div class="pro-compare" style="display: none;"><span data-content="收藏后您可进入我的同程-我的收藏进行查看。" attr-id="{{=pro.id}}" class="J_Store store J_Tips"><i></i>收藏</span>{{?pro.isTpackage == '0'}}|<span attr-tit="{{=pro.title}}" attr-price="{{=pro.tcPrice}}" attr-id="{{=pro.id}}" class="compare"><i></i>对比</span>{{?}}</div>
                    </div>
                    <div class="line-pricebox">
                        <div class="price-mid">
                            {{?pro.tcPrice != 0}}
                                <p class="line-price"><em>¥</em>{{=pro.tcPrice}}<i>起</i></p>
                            {{??}}
                                <p class="line-price"><em class="time-price">实时计价</em></p>
                            {{?}}
                            {{?pro.isBlh=="1" && pro.isSuper=="0" && pro.isStrict=="0"}}
                                <div class="line-sale">
                                    <span class="J_Tips" data-content='此优惠适用于{{=pro.minAmtDate.substring(0,4) + "-" + pro.minAmtDate.substring(4,6) + "-" + pro.minAmtDate.substring(6)}}出游，其余日期的优惠规则详见价格日历'>
                                        <span class="score-txt">积分抵扣</span><span class="score-price">抵<strong>{{=pro.blhAmount||""}}</strong>元/人</span>
                                    </span>
                                </div>
                            {{?}}
                            {{?pro.isSuper=="1" && pro.isStrict=="0"}}
                                <div class="line-sale">
                                    <span class="J_Tips" data-content='此优惠适用于{{=pro.minAmtDate.substring(0,4) + "-" + pro.minAmtDate.substring(4,6) + "-" + pro.minAmtDate.substring(6)}}出游，其余日期的优惠规则详见价格日历'>
                                        <span class="score-txt">VIP超值购</span><span class="score-price">抵<strong>{{=pro.superAmount||""}}</strong>元/人</span>
                                    </span>
                                </div>
                            {{?}}
                            {{?pro.isStrict=="1"}}
                                <div class="line-sale">
                                    <span class="J_Tips" data-content='此优惠适用于{{=pro.minAmtDate.substring(0,4) + "-" + pro.minAmtDate.substring(4,6) + "-" + pro.minAmtDate.substring(6)}}出游，其余日期的优惠规则详见价格日历'>
                                        <span class="score-txt">严选</span><span class="score-price">抵<strong>{{=pro.strictAmount||""}}</strong>元/人 返3%</span>
                                    </span>
                                </div>
                            {{?}}
                            <div class="line-hot">
                                {{?pro.satDeg == "0.0"}}
                                    <p class="newpro">新产品</p>
                                {{??}}
                                    <div class="hot-buy">
                                        <a target="_blank" data-id="{{=pro.id}}" target="_blank" onclick="_tcTraObj._tcTrackEvent('bq_chanpin', 'scj_dianping', '点评', ' ');" href="{{=linkUrl}}#CommentContent">
                                            <p class="buy-num">{{=pro.yearOrdCount}}人已购买</p>
                                            <p class="buy-num">{{=pro.cmtCount}}条评论</p>
                                            <div class="hot-sat">
                                                <p class="sat-num">{{=pro.satDeg.split(".")[0]}}<em>%</em></p>
                                                <p class="sat-txt">满意度</p>
                                            </div>    
                                        </a>
                                    </div>
                                {{?}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </li>
    {{~}}
</ul>
{{?}}