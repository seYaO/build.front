<!--packedDetail脚本中insurancelist  detail脚本里脚本有引用，由于附加产品增加,模块单独使用，注意注意-->
{{?(it.Data.Insurance && ((it.Data.Insurance.Accidents && it.Data.Insurance.Accidents.length) || (it.Data.Insurance.Cancles && it.Data.Insurance.Cancles.length))) || it.Data.AdditionProducts}}
<div class="other-box">
    <div class="package-title change-other"><i></i>
        <h2>其他产品</h2>
    </div>
</div>
<div class="specific-others">
    <span class="type_0">类型</span>
    <span class="type_1">产品名称</span>
    <span class="type_2">使用日期</span>
    <span class="type_3">同程价</span>
    <span class="type_4">份数</span>
</div>
<div class="box-others">
    <div class="allother-list">
        {{?it.Data.Insurance}}
            {{?it.Data.Insurance.Accidents && it.Data.Insurance.Accidents.length>0}}
            <div class="others-list Accidents-list">
                {{  var hasDefalut = false;
                    var arr = [];
                    for(var i=0;i<it.Data.Insurance.Accidents.length;i++){
                        if(it.Data.Insurance.Accidents[i].IsSelected==1){
                            hasDefalut =true;
                            arr.push(it.Data.Insurance.Accidents[i]);
                            break;
                        }
                    }
                    for(var i=0;i<it.Data.Insurance.Accidents.length;i++){
                        if(it.Data.Insurance.Accidents[i].IsSelected==0){
                            arr.push(it.Data.Insurance.Accidents[i]);
                        }
                    }
                }}
                {{?arr && arr.length>0}}
                <span class="otherType">意外险</span>
                {{?}}
                {{~arr:AccItems:index}}
                    {{  var totalNum = parseInt(it.Data.totalNum),price = parseInt(AccItems.Price);
                        var accPrice = totalNum*price;
                    }}
                    <div class="other-content {{?!index==0}}none{{?}}" data-name="{{=AccItems.Name}}" data-id="{{=AccItems.Id}}" data-num="{{=totalNum}}" data-single="{{=AccItems.Price}}" data-all="{{=accPrice}}">
                        <span class="product-others baoxian-others">
                            <em class="J_name_detail" data-content='<p>{{=AccItems.Name}}</p><p>最高赔{{=AccItems.Coverage}}</p>{{=AccItems.Detail}}{{=AccItems.ClauseUrl}}'>{{=AccItems.Name}}</em>
                        </span>
                        <span class="cal-date">--</span>
                        <span class="tc-other-price">￥{{=AccItems.Price}}</span>
                        <span class="num-others">{{=totalNum}}</span>
                        {{?hasDefalut}}
                            {{?AccItems.IsSelected==1}}
                            <input class="others-check ins_check radio_checked"  readonly="readonly" data-value="{{=AccItems.Id}}" >
                            {{??}}
                            <input class="others-check ins_check" readonly="readonly" data-value="{{=AccItems.Id}}">
                            {{?}}
                        {{??}}
                            {{?it.Data.AccidentCode || it.Data.AccidentCode == ""}}
                                <input class="others-check ins_check" readonly="readonly" data-value="{{=AccItems.Id}}">
                            {{??}}
                                {{?index==0}}
                                <input class="others-check ins_check radio_checked"  readonly="readonly" data-value="{{=AccItems.Id}}">
                                {{??}}
                                <input class="others-check ins_check" readonly="readonly" data-value="{{=AccItems.Id}}">
                                {{?}}
                            {{?}}
                        {{?}}
                    </div>
                {{~}}
                {{?arr && arr.length>1}}
                    <span class="more-others">更多意外险<i></i></span>
                {{?}}
            </div>
            {{?}}
            
            {{?it.Data.Insurance.Cancles && it.Data.Insurance.Cancles.length > 0}}
                {{var flightPrice,hotelPrice;
                    totalPrice = it.Data.TotalPrice/it.Data.totalNum;
                    var minValue=0,maxValue=0,valueKey=0;
                    var canLength = it.Data.Insurance.Cancles.length;
                    for(var j=0;j<canLength;j++){
                        minValue=it.Data.Insurance.Cancles[j].MinValue-1;
                        maxValue=it.Data.Insurance.Cancles[j].MaxValue+1;
                        if(totalPrice>minValue && totalPrice<maxValue){
                            valueKey = j;
                            break;
                        }
                    }
                    if(totalPrice>it.Data.Insurance.Cancles[canLength-1].MaxValue){
                        valueKey = canLength-1;
                    }
                }}
                {{~it.Data.Insurance.Cancles:Cancles:index}}
                {{?index === valueKey}}
                {{  var totalNum = parseInt(it.Data.totalNum),price = parseInt(Cancles.Insurance.Price);
                    var accPrice = totalNum*price;
                }}
                <div class="others-list Cancles-list">
                    <div class="other-content" data-id="{{=Cancles.Insurance.Id}}" data-num="{{=totalNum}}" data-single="{{=Cancles.Insurance.Price}}" data-all="{{=accPrice}}">
                        <span class="otherType">取消险</span>
                        <span class="product-others baoxian-others">
                            <em class="J_name_detail" data-content='<p>{{=Cancles.Insurance.Name}}</p><p>最高赔{{=Cancles.Insurance.Coverage}}</p>{{=Cancles.Insurance.Detail}}{{=Cancles.Insurance.ClauseUrl}}'>{{=Cancles.Insurance.Name}}</em>
                        </span>
                        <span class="cal-date">--</span>
                        <span class="tc-other-price">￥{{=Cancles.Insurance.Price}}</span>
                        <span class="num-others">{{=totalNum}}</span>
                        <input class='others-check ins_check {{?!it.Data.CancelCode && it.Data.CancelCode == ""}}{{??}}radio_checked{{?}}'  readonly="readonly" data-value="{{=Cancles.Insurance.Id}}">
                    </div>
                </div>
                {{?}}
                {{~}}
            {{?}}
        {{?}}
        
        {{?it.Data.AdditionProducts && it.Data.AdditionProducts.length>0}}
        {{~it.Data.AdditionProducts:Addition:ins}}
        <div class="others-list Addition-list" data-value ='{{=Addition.Category}}'>
            <span class="otherType">{{=Addition.Category}}</span>
            {{~Addition.Products:addList:ind}}
                {{?addList.IsSelected && addList.IsSelected==1 }}
                <div class="other-content add_content {{?!ind==0}}none{{?}}"  data-param ='{{=encodeURIComponent(JSON.stringify(addList))}}' data-name="{{=addList.Name}}" data-num="{{=addList.Book.Count}}" data-single="{{=addList.Book.Price}}" data-date="{{=addList.Book.Date}}">
                {{??}}
                <div class="other-content add_content {{?!ind==0}}none{{?}}"  data-param ='{{=encodeURIComponent(JSON.stringify(addList))}}' data-name="{{=addList.Name}}" data-num="{{=addList.Book.Count}}" data-single="{{=addList.Prices[0].Price}}" data-date="{{=addList.Prices[0].Date}}">
                {{?}}
                    <span class="product-others addition-others" >
                        {{
                            var ReceiveIns = addList.ReceiveInstruction,
                            GatherIns = addList.GatherInstruction;
                        }}
                        <em class="J_addition_detail" data-content='<div class="other_ins">
                            {{?addList.ImportantClause && addList.ImportantClause!=""}}
                                <p class="add_tit">重要条款</p>
                                <div class="add_con">{{=addList.ImportantClause}}</div>
                            {{?}}
                            {{?addList.ResourceInstruction && addList.ResourceInstruction!=""}}
                                <p class="add_tit">资源说明</p>
                                <div class="add_con">{{=addList.ResourceInstruction}}</div>
                            {{?}}
                            {{?ReceiveIns}}
                                <p class="add_tit">领取说明</p>
                                <div class="add_con">
                                    {{?ReceiveIns.ReceiveTypeName && ReceiveIns.ReceiveTypeName!=""}}<p>领取方式：{{=ReceiveIns.ReceiveTypeName}}</p>{{?}}
                                    {{?ReceiveIns.ReceiveSite && ReceiveIns.ReceiveSite!=""}}<p>领取地点：{{=ReceiveIns.ReceiveSite}}</p>{{?}}
                                    {{?ReceiveIns.ReceiveStartDate!="" && ReceiveIns.ReceiveEndDate!=""}}
                                        <p>领取时间：{{=ReceiveIns.ReceiveStartDate}}至{{=ReceiveIns.ReceiveEndDate}}</p>
                                    {{??ReceiveIns.ReceiveStartDate!="" && ReceiveIns.ReceiveEndDate==""}}
                                        <p>领取时间：{{=ReceiveIns.ReceiveStartDate}}</p>
                                    {{??ReceiveIns.ReceiveStartDate=="" && ReceiveIns.ReceiveEndDate!=""}}
                                        <p>领取时间：{{=ReceiveIns.ReceiveEndDate}}</p>
                                    {{?}}
                                    {{?ReceiveIns.BackSite && ReceiveIns.BackSite!=""}}<p>送还地点：{{=ReceiveIns.BackSite}}</p>{{?}}
                                    {{?ReceiveIns.BackStartDate!="" && ReceiveIns.BackEndDate!=""}}
                                        <p>送还时间：{{=ReceiveIns.BackStartDate}}至{{=ReceiveIns.BackEndDate}}</p>
                                    {{??ReceiveIns.BackStartDate!="" && ReceiveIns.BackEndDate==""}}
                                        <p>送还时间：{{=ReceiveIns.BackStartDate}}</p>
                                    {{??ReceiveIns.BackStartDate=="" && ReceiveIns.BackEndDate!=""}}
                                        <p>送还时间：{{=ReceiveIns.BackEndDate}}</p>
                                    {{?}}

                                </div>
                            {{?}}
                            {{?GatherIns}}
                                <p class="add_tit">集合说明</p>
                                <div class="add_con">
                                    {{?GatherIns.GatherSite && GatherIns.GatherSite!=""}}<p>集合地点：{{=GatherIns.GatherSite}}</p>{{?}}
                                    {{?GatherIns.GatherStartDate!="" && GatherIns.GatherEndDate!=""}}
                                        <p>集合时间：{{=GatherIns.GatherStartDate}}至{{=GatherIns.GatherEndDate}}</p>
                                    {{??GatherIns.GatherStartDate!="" && GatherIns.GatherEndDate==""}}
                                        <p>集合时间：{{=GatherIns.GatherStartDate}}</p>
                                    {{??GatherIns.GatherStartDate=="" && GatherIns.GatherEndDate!=""}}
                                        <p>集合时间：{{=GatherIns.GatherEndDate}}</p>
                                    {{?}}
                                    {{?GatherIns.DissolveSite && GatherIns.DissolveSite!=""}}<p>解散地点：{{=GatherIns.DissolveSite}}</p>{{?}}
                                    {{?GatherIns.DissolveStartDate!="" && GatherIns.DissolveEndDate!=""}}
                                        <p>解散时间：{{=GatherIns.DissolveStartDate}}至{{=GatherIns.DissolveEndDate}}</p>
                                    {{??GatherIns.DissolveStartDate!="" && GatherIns.DissolveEndDate==""}}
                                        <p>解散时间：{{=GatherIns.DissolveStartDate}}</p>
                                    {{??GatherIns.DissolveStartDate=="" && GatherIns.DissolveEndDate!=""}}
                                        <p>解散时间：{{=GatherIns.DissolveEndDate}}</p>
                                    {{?}}
                                </div>
                            {{?}}
                            <p class="add_tip" style="font-size:12px;">提示：该产品一经支付，不支持更换和退订</p>
                        </div>' >{{=addList.Name}}</em>
                    </span>
                    
                    {{?addList.IsShowCalendar&&addList.IsShowCalendar==1}}
                        <span class="cal-date">
                            <div class="select_other">
                                {{
                                    var dateValue = "",
                                        dataPrice = 0,
                                        EveryDayPrice = 0;
                                    if(addList.IsSelected &&addList.IsSelected==1 ){
                                        dateValue = addList.Book.Date;
                                        dataPrice = addList.Book.Price;
                                    }else{
                                        if(addList.IsSumEveryDayPrice && addList.IsSumEveryDayPrice==1){
                                            for(var i=0;i<addList.Prices.length;i++){
                                                EveryDayPrice += parseInt(addList.Prices[i]);
                                            }
                                            dataPrice = EveryDayPrice;
                                        }
                                    }   
                                }}
                                <input class="J_ui_select select_date" type="text"  data-value="{{=dataPrice}}"  data-date="{{=dateValue}}"  placeholder="请选择日期" readonly="readonly" value="{{=dateValue}}" >
                                {{?addList.Prices&&addList.Prices.length>0}}
                                <ul class="J_other_num other_num none">
                                    {{~addList.Prices:dateList}}
                                        <li data-value="{{?addList.IsSumEveryDayPrice && addList.IsSumEveryDayPrice==1}}{{=EveryDayPrice}}{{??}}{{=dateList.Price}}{{?}}"  data-date="{{=dateList.Date}}">
                                        {{=dateList.Date}}
                                        </li>
                                    {{~}}
                                </ul>
                                {{?}}
                            </div>
                        </span>
                    {{??}}
                        {{?addList.IsSelected==1 && addList.IsShowFirstDate==1}}
                        <span class="cal-date">{{=addList.Book.Date}}</span>
                        {{??addList.IsSelected==0&&addList.IsShowFirstDate==1 && addList.Prices&& addList.Prices.length>0}}
                        <span class="cal-date">{{=addList.Prices[0].Date}}</span>
                        {{??}}
                        <span class="cal-date">--</span>
                        {{?}}
                    {{?}}
                    
                    <span class="tc-other-price">&yen;{{?addList.Book.Price!=0}}{{=addList.Book.Price}}{{??}}{{=addList.ShowPrice}}{{?}}</span>
                    <span class="num-others">
                        <div class="select_other">
                            <input  class="J_ui_select select_num" type="text"  readonly="readonly" value="{{?addList.Book.Count!=0}}{{=addList.Book.Count}}{{??}}0{{?}}" >
                            <ul class="J_other_num other_num none" >
                            {{
                                var str = "";
                                if(parseInt(addList.Min)!=0){
                                    str += '<li>0</li>';
                                }
                                for(var i=parseInt(addList.Min);i<(parseInt(addList.Max) +1);i++){
                                    str += '<li>'+ i +'</li>';
                                }
                            }}
                            {{=str}}
                            </ul>
                        </div>
                    </span>

                    {{?addList.Book.Count!=0 && addList.IsSelected==1}}
                    <input class="others-check radio_checked" readonly="readonly">
                    {{??}}
                    <input class="others-check" readonly="readonly">
                    {{?}}
                </div>
            {{~}}
            {{?Addition.Products && Addition.Products.length>1}}
            <span class="more-others" data-name="更多{{=Addition.Category}}">更多{{=Addition.Category}}<i></i></span>
            {{?}}
        </div>
        {{~}}
        {{?}}
    </div>
</div>
{{?}}
